<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cliente API JSON</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/estilos.css') }}">
</head>
<body>

    <div class="contenedor">
        <h1>API JSON</h1>

        <div class="formulario">
            <input type="text" id="inputItem" placeholder="Nuevo item para la API...">
            <button onclick="enviarDatosAPI()" class="btn-morado">Enviar a API (POST)</button>
        </div>

        <hr>

        <div class="acciones-extra">
            <button onclick="cargarDatosAPI()" class="btn-secundario">Actualizar Lista (GET)</button>
        </div>

        <ul id="listaResultados" class="lista">
        </ul>

    </div>

    <script>
        // --- FUNCIÓN 1: OBTENCIÓN DE RECURSOS (GET) ---
        function cargarDatosAPI() {
            // Se realiza la petición fetch a la ruta de Python configurada para GET.
            fetch('/api/items')
                .then(response => response.json()) // Se transforma la respuesta al formato JSON.
                .then(data => {
                    // Se procede al vaciado del contenedor de la lista antes de la inserción.
                    const lista = document.getElementById('listaResultados');
                    lista.innerHTML = '';

                    // Se recorre cada elemento recibido desde el servidor.
                    data.forEach(elemento => {
                        // Se genera un nuevo nodo de lista (li) para cada registro.
                        const li = document.createElement('li');
                        li.className = 'item-api';
                        // Se inserta el contenido dinámico con el ID y el nombre.
                        li.innerHTML = `<span class="tag">ID ${elemento.id}</span> ${elemento.nombre}`;
                        // Se incorpora el nodo al DOM para su visualización.
                        lista.appendChild(li);
                    });
                });
        }

        // --- FUNCIÓN 2: ENVÍO DE INFORMACIÓN (POST) ---
        function enviarDatosAPI() {
            // Se capturan el elemento de entrada y su valor actual.
            const input = document.getElementById('inputItem');
            const texto = input.value;

            // Se verifica la existencia de contenido antes de procesar la solicitud.
            if (texto) {
                // Se ejecuta la petición fetch utilizando el método POST.
                fetch('/api/items', {
                    method: 'POST',
                    headers: {
                        // Se especifica el tipo de contenido como aplicación JSON.
                        'Content-Type': 'application/json'
                    },
                    // Se serializa el objeto de JavaScript a una cadena JSON.
                    body: JSON.stringify({ item: texto })
                })
                .then(response => response.json())
                .then(data => {
                    // Se registra la confirmación del servidor en la consola.
                    console.log("Estado del guardado:", data);
                    // Se limpia el campo de texto para nuevas entradas.
                    input.value = '';
                    // Se dispara la actualización automática de la lista.
                    cargarDatosAPI();
                });
            }
        }

        // --- INICIALIZACIÓN ---
        // Se ejecuta la carga de datos de manera automática al finalizar la carga del documento.
        cargarDatosAPI();
    </script>

</body>
</html>